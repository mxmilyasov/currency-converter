{% extends 'index.html.twig' %}

{% block customStylesheets %}
{% endblock %}

{% block titleText %}Converter{% endblock %}

{% block body %}
    <div class="app-content pt-3 p-md-3 p-lg-4">
        <div class="container-xl">

            <h1 class="app-page-title">Конвертер валют</h1>

            <div class="app-card shadow-sm mb-4">
                <div class="inner">
                    <div class="app-card-body p-4 p-lg-4">

                        <div id="log" class="app-card app-card-stat">

                            <div class="app-card-body pb-4">
                                <h4 class="stats-type mb-1">ЦБ РБ на {{ lastConvertResult['createdAt']|date('d.m.y') }}</h4>
                                <span class="stats-figure">{{ lastConvertResult['amount']|replace({'.': ","}) }}</span> {{ lastConvertResult['fromCurrency'] }} <span class="stats-figure"> = {{ lastConvertResult['convertResult']|replace({'.': ","}) }}</span> {{ lastConvertResult['toCurrency'] }}
                            </div>

                        </div>

                        <form id="currencyConverterForm" class="row gy-2 gx-3 align-items-center">
                            <div class="col-md-2 col-lg-2">
                                <label class="visually-hidden" for="autoSizingInput">Name</label>
                                <input type="number" step="any" class="form-control w-200" id="amount"
                                       name="amount" placeholder="" required>
                            </div>
                            <div class="col-md-3 col-lg-3">
                                <label class="visually-hidden" for="autoSizingSelect">Preference</label>
                                <select id="fromCurrency" name="fromCurrency" class="form-select">
                                    {% for currency in currencies %}
                                        <option {{ currency == lastConvertResult['fromCurrency'] ? 'selected' }}>{{ currency }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3 col-lg-3">
                                <label class="visually-hidden" for="autoSizingSelect">Preference</label>
                                <select id="toCurrency" name="toCurrency" class="form-select">
                                    {% for currency in currencies %}
                                        <option {{ currency == lastConvertResult['toCurrency'] ? 'selected' }}>{{ currency }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3 col-lg-3">
                                <button id="currencyConverterBtn" type="submit"
                                        class="btn app-btn-primary w-auto h-auto">Конвертировать
                                </button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>

            <h1 class="app-page-title">Статистика</h1>

            <div class="row g-4 mb-4">
                <div class="col-6 col-lg-3">
                    <div class="app-card app-card-stat shadow-sm h-100">
                        <div class="app-card-body p-3 p-lg-4">
                            <h4 class="stats-type mb-1">Total Sales</h4>
                            <div class="stats-figure">$12,628</div>
                            <div class="stats-meta text-success">
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-up"
                                     fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                          d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                                </svg>
                                20%
                            </div>
                        </div>
                        <a class="app-card-link-mask" href="#"></a>
                    </div>
                </div>

                <div class="col-6 col-lg-3">
                    <div class="app-card app-card-stat shadow-sm h-100">
                        <div class="app-card-body p-3 p-lg-4">
                            <h4 class="stats-type mb-1">Expenses</h4>
                            <div class="stats-figure">$2,250</div>
                            <div class="stats-meta text-success">
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-down"
                                     fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                          d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                                </svg>
                                5%
                            </div>
                        </div>
                        <a class="app-card-link-mask" href="#"></a>
                    </div>
                </div>
                <div class="col-6 col-lg-3">
                    <div class="app-card app-card-stat shadow-sm h-100">
                        <div class="app-card-body p-3 p-lg-4">
                            <h4 class="stats-type mb-1">Projects</h4>
                            <div class="stats-figure">23</div>
                            <div class="stats-meta">
                                Open
                            </div>
                        </div>
                        <a class="app-card-link-mask" href="#"></a>
                    </div>
                </div>
                <div class="col-6 col-lg-3">
                    <div class="app-card app-card-stat shadow-sm h-100">
                        <div class="app-card-body p-3 p-lg-4">
                            <h4 class="stats-type mb-1">Invoices</h4>
                            <div class="stats-figure">6</div>
                            <div class="stats-meta">New</div>
                        </div>
                        <a class="app-card-link-mask" href="#"></a>
                    </div>
                </div>
            </div>

        </div>
    </div>
{% endblock %}

{% block customJavascripts %}
    <script>

        function logSubmit(event) {

            // const form = document.getElementById('currencyConverterForm');
            // let formData = new FormData(form);
            //
            // log.textContent = `Form Submitted! Time stamp: ${event.timeStamp}`;
            // event.preventDefault();

        }

        const form = document.getElementById('currencyConverterForm');
        const log = document.getElementById('log');
        form.addEventListener('submit', logSubmit);


        $(document).ready(function () {
            $('#currencyConverterForm').on("submit", function (event) {
                event.preventDefault();

                const formData = $(this).serialize();

                $.ajax({
                    type: 'POST',
                    url: 'convert',
                    data: formData,
                    success: (response) => {

                        let resultWrapper = {};
                        const form = document.getElementById('currencyConverterForm');

                        for (let i = 0; i < form.elements.length; i++) {
                            let e = form.elements[i];

                            if (e.value !== '') {
                                resultWrapper[e.name] = e.value;
                            }
                        }

                        const log = document.getElementById('log');

                        const localDate = new Date().toLocaleDateString();

                        let inner = `
                            <div class="app-card-body pb-4">
                                    <h4 class="stats-type mb-1">ЦБ РБ на ${localDate}</h4>
                                    <span class="stats-figure">${resultWrapper.amount}</span> ${resultWrapper.fromCurrency} <span class="stats-figure"> = ${response}</span> ${resultWrapper.toCurrency}
                            </div>
                        `;

                        log.innerHTML = inner;
                    }
                });

            });
        });

    </script>
{% endblock %}